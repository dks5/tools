<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Инструкция по замене изображений</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        :root {
            --bg-color: #0d0d0d;
            --card-bg: #1a1a1a;
            --border-color: #2e2e2e;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --glow-color: #007bff;
            --gradient-start: #007bff;
            --gradient-end: #8a2be2;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            transition: background-color 0.5s;
        }
        
        /* The container surrounding the main card, with a slightly lighter background */
        .page-container {
            background-color: #111;
            padding: 2rem;
            min-height: 100vh;
        }

        /* Gradient and glow effect */
        .gradient-text {
            background: linear-gradient(45deg, var(--gradient-start), var(--gradient-end));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: inline-block;
        }

        .gradient-bg {
            background: linear-gradient(45deg, var(--gradient-start), var(--gradient-end));
        }

        .glow {
            box-shadow: 0 0 10px var(--glow-color), 0 0 20px var(--glow-color);
        }

        /* Card and components styling */
        .card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4), 0 0 25px var(--glow-color);
        }

        .card h1, .card h2, .card h3, .card h4, .card p, .card .lead {
            color: var(--text-primary);
        }
        
        .form-label {
            color: var(--text-secondary);
        }

        .form-control {
            background-color: #2e2e2e;
            border: 1px solid #444;
            color: var(--text-primary);
        }
        .form-control::placeholder {
            color: var(--text-secondary);
            opacity: 0.7;
        }
        .form-control:focus {
            background-color: #2e2e2e;
            border-color: var(--gradient-start);
            box-shadow: 0 0 0 0.25rem rgba(0, 123, 255, 0.25);
            color: var(--text-primary);
        }

        /* Buttons */
        .btn {
            border-radius: 0.5rem;
            font-weight: bold;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            color: var(--text-primary); /* Ensure button text is visible */
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--gradient-start), var(--gradient-end));
            border: none;
        }

        .btn-primary:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 123, 255, 0.5); /* Enhanced glow on hover */
        }

        .btn-danger {
            background: #dc3545;
            border-color: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
            border-color: #bd2130;
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.5); /* Glow for danger button */
        }

        .btn-outline-secondary {
            color: var(--text-secondary);
            border-color: var(--text-secondary);
        }
        .btn-outline-secondary:hover {
            background-color: var(--text-secondary);
            color: var(--card-bg);
            box-shadow: 0 5px 15px rgba(160, 160, 160, 0.5); /* Glow for outline button */
        }
        
        .btn-link-glow {
            text-decoration: none;
            box-shadow: none;
            color: var(--text-primary);
        }
        
        .btn-link-glow:hover {
            transform: none;
            box-shadow: none;
            text-decoration: underline;
        }

        /* Tabs */
        .nav-tabs {
            border-bottom: 1px solid var(--border-color);
        }
        .nav-link {
            color: var(--text-secondary);
            border: none;
            border-bottom: 3px solid transparent;
            background: transparent; /* Убрал фон */
            transition: border-bottom 0.3s, color 0.3s;
        }
        .nav-link.active {
            background: transparent; /* Убрал фон */
            color: transparent;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-image: linear-gradient(45deg, var(--gradient-start), var(--gradient-end));
            border-bottom: none !important;
            box-shadow: none;
        }
        .nav-link:hover {
            color: var(--text-primary);
            border-bottom: 3px solid var(--gradient-start);
        }

        /* Code blocks */
        .code-style {
            background-color: #111;
            color: #d4d4d4;
            border-radius: 0.5rem;
            padding: 1rem;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            border: 1px solid var(--border-color);
            position: relative;
        }
        
        .code-container {
            position: relative;
        }

        .copy-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: #2e2e2e;
            color: var(--text-secondary);
            border: 1px solid #444;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.2s;
            cursor: pointer;
        }

        .copy-btn:hover {
            background-color: var(--gradient-start);
            color: var(--text-primary);
            box-shadow: 0 0 10px var(--gradient-start);
        }
        
        /* Step numbers */
        .step-number {
            width: 2.5rem;
            aspect-ratio: 1 / 1;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1rem;
            font-weight: bold;
            color: var(--text-primary);
            border-radius: 50%;
            margin-right: 1.5rem;
            background: linear-gradient(45deg, var(--gradient-start), var(--gradient-end));
            box-shadow: 0 0 10px var(--glow-color);
        }

        /* Content spacing */
        .theory-content p, .faq-content p, .data-content p, .data-content ul, .theory-content li, .faq-content li {
            line-height: 1.8;
            margin-bottom: 1rem;
            color: var(--text-secondary);
        }
        
        .theory-content h4, .faq-content h4, .data-content h4 {
            margin-top: 2rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--gradient-end);
            padding-bottom: 0.5rem;
            color: var(--text-primary);
        }
        
        .theory-content h5, .faq-content h5, .data-content h5 {
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }
        
        .data-content code {
            background-color: #343a40;
            padding: 0.2em 0.4em;
            margin: 0;
            font-size: 85%;
            border-radius: 6px;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1050;
        }

        .modal-content {
            background-color: var(--card-bg);
            color: var(--text-primary);
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            max-width: 500px;
            text-align: center;
            border: 1px solid var(--border-color);
        }
        
        /* Ensure all text is visible on the dark background */
        .page-container, .card, body {
            color: var(--text-primary);
        }
        
        .card p, .card li, .card span {
            color: var(--text-secondary);
        }

        @media (max-width: 767.98px) {
            .profile-section {
                flex-direction: column;
                gap: 0.5rem;
            }
            .profile-section button {
                width: 100%;
            }
        }
    </style>
</head>
<body>

    <div class="page-container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card p-4">
                    <h2 class="text-center mb-4 gradient-text">Динамическая инструкция по замене изображений из GitHub</h2>
                    <hr class="my-4" style="background: linear-gradient(90deg, transparent, var(--gradient-start), transparent); height: 1px; border: none;">

                    <!-- Tabs -->
                    <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="instructions-tab" data-bs-toggle="tab" data-bs-target="#instructions" type="button" role="tab" aria-controls="instructions" aria-selected="true">Инструкция</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="theory-tab" data-bs-toggle="tab" data-bs-target="#theory" type="button" role="tab" aria-controls="theory" aria-selected="false">Теория</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="faq-tab" data-bs-toggle="tab" data-bs-target="#faq" type="button" role="tab" aria-controls="faq" aria-selected="false">Вопросы и ответы</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="data-tab" data-bs-toggle="tab" data-bs-target="#data" type="button" role="tab" aria-controls="data" aria-selected="false">Данные</button>
                        </li>
                    </ul>

                    <!-- Tab content -->
                    <div class="tab-content" id="myTabContent">
                        <!-- "Инструкция" Tab -->
                        <div class="tab-pane fade show active" id="instructions" role="tabpanel" aria-labelledby="instructions-tab">
                            <p class="text-center lead" style="color: var(--text-secondary);">Следуйте этим простым шагам, чтобы сгенерировать HTML-код с прямой ссылкой на изображение.</p>
                            
                            <!-- Step 1 -->
                            <div class="d-flex align-items-start mb-4">
                                <div class="step-number gradient-bg">1</div>
                                <div>
                                    <h4 class="gradient-text">Конфигурация переменных</h4>
                                    <p style="color: var(--text-secondary);">Введите данные вашего GitHub-репозитория.</p>
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label for="userName" class="form-label">Имя пользователя (переменная #1):</label>
                                            <input type="text" id="userName" class="form-control" placeholder="Например: gemini-coder" oninput="updateUrl()">
                                        </div>
                                        <div class="col-md-6">
                                            <label for="repoName" class="form-label">Имя репозитория (переменная #2):</label>
                                            <input type="text" id="repoName" class="form-control" placeholder="Например: my-project" oninput="updateUrl()">
                                        </div>
                                        <div class="col-12">
                                            <label for="fileName" class="form-label">Имя файла (переменная #3):</label>
                                            <input type="text" id="fileName" class="form-control" placeholder="Например: image.jpg" oninput="updateUrl()">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Step 2 -->
                            <div class="d-flex align-items-start mb-4">
                                <div class="step-number gradient-bg">2</div>
                                <div>
                                    <h4 class="gradient-text">Сгенерированные URL-адреса</h4>
                                    <p style="color: var(--text-secondary);">Ссылки автоматически обновляются после ввода данных.</p>
                                    <div class="mb-3">
                                        <label class="form-label">Ссылка для встраивания (raw):</label>
                                        <div class="code-container">
                                            <button class="copy-btn" onclick="copyCode('rawUrlCodeBlock')">
                                                <i class="bi bi-clipboard"></i>
                                            </button>
                                            <pre id="rawUrlCodeBlock" class="code-style"></pre>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="form-label">Путь к файлу на GitHub:</label>
                                        <div class="code-container">
                                            <button class="copy-btn" onclick="copyCode('githubUrlCodeBlock')">
                                                <i class="bi bi-clipboard"></i>
                                            </button>
                                            <pre id="githubUrlCodeBlock" class="code-style"></pre>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Step 3 -->
                            <div class="d-flex align-items-start mb-4">
                                <div class="step-number gradient-bg">3</div>
                                <div>
                                    <h4 class="gradient-text">HTML-код для вставки</h4>
                                    <p style="color: var(--text-secondary);">Скопируйте этот код и вставьте его на свою веб-страницу.</p>
                                    <div class="code-container">
                                        <button class="copy-btn" onclick="copyCode('codeBlock')">
                                            <i class="bi bi-clipboard"></i>
                                        </button>
                                        <pre id="codeBlock" class="code-style">
&lt;img src="" alt="Изображение" class="w-full h-auto rounded-lg shadow-md"/&gt;
                                        </pre>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Profile Management Section -->
                            <div class="mt-5">
                                <h4 class="gradient-text">Управление профилями</h4>
                                <div class="row g-2 align-items-center">
                                    <div class="col-12 col-md-6">
                                        <div class="input-group">
                                            <select id="profileSelect" class="form-select"></select>
                                            <button class="btn btn-outline-secondary btn-link-glow" type="button" onclick="loadProfile()"><i class="bi bi-folder2-open me-2"></i>Загрузить</button>
                                        </div>
                                    </div>
                                    <div class="col-12 col-md-6 d-flex gap-2">
                                        <button class="btn btn-primary w-50" onclick="saveProfile()"><i class="bi bi-bookmark me-2"></i>Сохранить</button>
                                        <button class="btn btn-danger w-50" onclick="showDeleteConfirm()"><i class="bi bi-trash me-2"></i>Удалить</button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Data Management Buttons -->
                            <div class="d-flex flex-column flex-sm-row justify-content-between gap-2 mt-4">
                                <button class="btn btn-primary" onclick="exportVariables()">
                                    <i class="bi bi-download me-2"></i>Экспорт в JSON
                                </button>
                                <button class="btn btn-danger" onclick="clearVariables()">
                                    <i class="bi bi-x-circle me-2"></i>Очистить переменные
                                </button>
                            </div>

                            <div id="statusMessage" class="alert mt-3 d-none"></div>
                        </div>

                        <!-- "Теория" Tab -->
                        <div class="tab-pane fade theory-content" id="theory" role="tabpanel" aria-labelledby="theory-tab">
                            <h4 class="gradient-text">Что такое `raw.githubusercontent.com`?</h4>
                            <p>
                                `https://raw.githubusercontent.com/` — это специальный домен, который GitHub использует для выдачи <strong>«сырого»</strong> (raw) содержимого файлов из репозиториев.
                            </p>
                            
                            <hr class="my-4" style="background: linear-gradient(90deg, transparent, var(--gradient-end), transparent); height: 1px; border: none;">

                            <h5 class="h5">В чём разница между `github.com` и `raw.githubusercontent.com`?</h5>
                            <p>
                                Когда вы открываете файл, например, изображение, на сайте `github.com`, вы видите не только само изображение, но и всю веб-страницу GitHub вокруг него: заголовок репозитория, кнопки, комментарии и т.д. Этот путь предназначен для <strong>просмотра</strong> файла в веб-интерфейсе.
                            </p>
                            <p>
                                Когда вы используете путь с `raw.githubusercontent.com`, вы получаете доступ к самому файлу <strong>без какого-либо форматирования или окружения GitHub</strong>. Браузер сразу видит, что это файл изображения, и может использовать его напрямую. Это идеальный способ для встраивания изображений, CSS-стилей или JavaScript-файлов в другие веб-страницы.
                            </p>
                            
                            <hr class="my-4" style="background: linear-gradient(90deg, transparent, var(--gradient-end), transparent); height: 1px; border: none;">

                            <h5 class="h5">Структура URL-адреса</h5>
                            <p>
                                Путь имеет чёткую структуру, которую мы используем в нашей инструкции:
                            </p>
                            <ul>
                                <li><strong>`https://raw.githubusercontent.com/`</strong> — базовая часть для "сырого" контента.</li>
                                <li><strong>`имя-пользователя`</strong> — имя пользователя или организации.</li>
                                <li><strong>`имя-репозитория`</strong> — имя вашего репозитория.</li>
                                <li><strong>`ветка`</strong> — имя ветки, где находится файл, чаще всего это `main` или `master`.</li>
                                <li><strong>`имя-файла`</strong> — полный путь к файлу в репозитории.</li>
                            </ul>
                        </div>
                        
                        <!-- "Вопросы и ответы" Tab -->
                        <div class="tab-pane fade faq-content" id="faq" role="tabpanel" aria-labelledby="faq-tab">
                            <h4 class="gradient-text">Вопросы и ответы</h4>
                            
                            <h5 class="h5">Где должен находиться мой файл? На `raw.githubusercontent.com` или на `github.com`?</h5>
                            <p>
                                Ваш файл должен находиться в репозитории на <strong>`github.com`</strong>. Это платформа, где вы храните свои проекты.
                            </p>
                            <p>
                                Путь <strong>`https://raw.githubusercontent.com/`</strong> — это не место для хранения, а специальный адрес для <strong>получения</strong> этого файла напрямую, без веб-интерфейса GitHub. Именно эту ссылку нужно использовать для вставки изображений на другие веб-страницы.
                            </p>

                            <hr class="my-4" style="background: linear-gradient(90deg, transparent, var(--gradient-end), transparent); height: 1px; border: none;">

                            <h5 class="h5">Что означает `blob` в пути к файлу?</h5>
                            <p>
                                <strong>`blob`</strong> в пути к файлу на GitHub — это сокращение от <strong>"Binary Large Object"</strong> (двоичный большой объект). Когда вы видите `.../blob/main/...`, это означает, что вы просматриваете <strong>содержимое файла</strong> в веб-интерфейсе GitHub. Это часть адреса, которую GitHub добавляет автоматически для отображения файла на своей странице.
                            </p>

                            <hr class="my-4" style="background: linear-gradient(90deg, transparent, var(--gradient-end), transparent); height: 1px; border: none;">

                            <h5 class="h5">Почему в URL, который я ввожу, нет `blob`?</h5>
                            <p>
                                Вы не указываете `blob` самостоятельно, потому что это не часть пути к вашему файлу в репозитории. `blob` — это часть веб-адреса, которую GitHub автоматически добавляет, чтобы показать вам содержимое файла. Вы работаете с фактической структурой репозитория, а GitHub сам формирует полный URL для просмотра.
                            </p>
                            
                            <hr class="my-4" style="background: linear-gradient(90deg, transparent, var(--gradient-end), transparent); height: 1px; border: none;">

                            <h5 class="h5">Почему имя репозитория в URL меняется, а `blob` — нет?</h5>
                            <p>
                                <strong>`blob`</strong> — это постоянная часть адреса, которая показывает, что вы просматриваете содержимое файла. Она <strong>не меняется</strong>. Когда вы вводите название своего репозитория, меняется именно эта часть адреса. Они находятся в разных частях URL и служат для разных целей.
                            </p>

                            <hr class="my-4" style="background: linear-gradient(90deg, transparent, var(--gradient-end), transparent); height: 1px; border: none;">

                            <h5 class="h5">Используется ли `blob` при просмотре HTML-страницы?</h5>
                            <p>
                                Нет, когда вы просматриваете HTML-страницу как полноценный веб-сайт (например, через GitHub Pages), часть `blob` в пути <strong>не используется</strong>. Она нужна только для просмотра исходного кода файла в интерфейсе GitHub.
                            </p>
                            
                            <hr class="my-4" style="background: linear-gradient(90deg, transparent, var(--gradient-end), transparent); height: 1px; border: none;">

                            <h5 class="h5">Что будет, если я переименую или перемещу файл изображения?</h5>
                            <p>
                                К сожалению, ссылка перестанет работать. URL-адрес, который мы генерируем, напрямую зависит от точного пути к файлу в вашем репозитории. Если вы переименуете файл или переместите его в другую папку, вам придётся обновить и ссылку в своём HTML-коде, чтобы она указывала на новое местоположение.
                            </p>

                            <hr class="my-4" style="background: linear-gradient(90deg, transparent, var(--gradient-end), transparent); height: 1px; border: none;">

                            <h5 class="h5">Почему моё изображение не отображается на странице?</h5>
                            <p>
                                Есть несколько распространённых причин:
                            </p>
                            <ul>
                                <li><strong>Неправильный путь:</strong> Убедитесь, что вы правильно ввели имя пользователя, репозитория и файла. Регистр символов имеет значение!</li>
                                <li><strong>Неправильная ветка:</strong> Убедитесь, что ваш файл находится в ветке <code>main</code> (или <code>master</code>), как указано в URL-адресе.</li>
                                <li><strong>Файл не закоммичен:</strong> Если вы только что добавили файл в репозиторий, но не закоммитили и не отправили изменения (<code>commit</code>, <code>push</code>), он не будет доступен по ссылке.</li>
                            </ul>
                            
                            <hr class="my-4" style="background: linear-gradient(90deg, transparent, var(--gradient-end), transparent); height: 1px; border: none;">

                            <h5 class="h5">Что будет, если я открою эту HTML-страницу в другом браузере?</h5>
                            <p>
                                Поскольку данные профилей хранятся локально в вашем браузере с помощью технологии <strong>`localStorage`</strong>, они <strong>не будут доступны</strong> в другом браузере. `localStorage` изолирован для каждого браузера. Если вы откроете страницу в другом браузере или на другом устройстве, список профилей будет пустым.
                            </p>
                             <p>
                                Если вам нужно перенести профили на другой компьютер или в другой браузер, используйте функцию <strong>«Экспорт в JSON»</strong> на вкладке «Инструкция». Вы получите файл, который можно сохранить на компьютере. Затем вы сможете загрузить этот файл в новом браузере, чтобы восстановить все профили.
                            </p>
                        </div>
                        
                        <!-- "Данные" Tab -->
                        <div class="tab-pane fade data-content" id="data" role="tabpanel" aria-labelledby="data-tab">
                            <h4 class="gradient-text">Управление данными</h4>
                            <p>
                                Приложение использует два разных способа сохранения данных, которые служат для разных целей. Важно понимать их различия.
                            </p>

                            <hr class="my-4" style="background: linear-gradient(90deg, transparent, var(--gradient-end), transparent); height: 1px; border: none;">

                            <h5 class="h5">1. Профили (Локальное хранилище в браузере)</h5>
                            <p>
                                Профили, которые вы сохраняете с помощью кнопки <strong>«Сохранить»</strong>, хранятся в вашем браузере с помощью технологии <code>localStorage</code>. Это встроенная функция, которая позволяет веб-сайтам сохранять небольшие объёмы данных прямо на вашем компьютере.
                            </p>
                            <ul>
                                <li><strong>Цель:</strong> Сохранение данных для быстрого доступа в текущем браузере.</li>
                                <li><strong>Формат:</strong> Данные сохраняются в виде <code>JSON-объекта</code> и остаются доступными даже после закрытия страницы или браузера.</li>
                                <li><strong>Доступность:</strong> Эти данные <strong>не будут доступны</strong> в другом браузере или на другом устройстве. <code>localStorage</code> полностью изолирован для каждого браузера.</li>
                            </ul>
                            
                            <hr class="my-4" style="background: linear-gradient(90deg, transparent, var(--gradient-end), transparent); height: 1px; border: none;">

                            <h5 class="h5">2. Экспорт в JSON-файл (Портативное хранилище)</h5>
                            <p>
                                Кнопка <strong>«Экспорт в JSON»</strong> служит для другой цели. Она берёт текущие данные из полей ввода и сохраняет их в виде файла с расширением <code>.json</code>, который вы можете загрузить на свой компьютер.
                            </p>
                            <ul>
                                <li><strong>Цель:</strong> Обеспечение <strong>переносимости</strong> данных. Этот файл можно использовать для резервного копирования или для переноса информации на другой компьютер, в другой браузер или даже для обмена с другими пользователями.</li>
                                <li><strong>Формат:</strong> Стандартный текстовый файл <code>JSON</code>.</li>
                                <li><strong>Доступность:</strong> Файл сохраняется на вашем компьютере, и вы можете использовать его где угодно. Он не привязан к конкретному браузеру.</li>
                            </ul>

                            <hr class="my-4" style="background: linear-gradient(90deg, transparent, var(--gradient-end), transparent); height: 1px; border: none;">
                            
                            <h5 class="h5">Ключевое различие</h5>
                            <p>
                                <code>Локальные профили</code> (<code>localStorage</code>) — это данные для вашего удобства, которые живут только в одном браузере.
                            </p>
                            <p>
                                <code>JSON-файл</code> — это способ «упаковать» ваши данные для переноса и использования где угодно.
                            </p>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Modal for saving profile -->
    <div id="saveProfileModal" class="modal-overlay d-none">
        <div class="modal-content">
            <h5 class="mb-3">Сохранить профиль как...</h5>
            <input type="text" id="profileNameInput" class="form-control mb-3" placeholder="Введите имя профиля">
            <div class="d-flex justify-content-center gap-3">
                <button class="btn btn-primary" onclick="saveProfileFromModal()">Сохранить</button>
                <button class="btn btn-outline-secondary btn-link-glow" onclick="hideSaveModal()">Отмена</button>
            </div>
        </div>
    </div>

    <!-- Modal for delete confirmation -->
    <div id="confirmModal" class="modal-overlay d-none">
        <div class="modal-content">
            <p id="confirmMessage" class="lead"></p>
            <div class="d-flex justify-content-center gap-3">
                <button class="btn btn-danger" onclick="confirmAction(true)">Удалить</button>
                <button class="btn btn-outline-secondary btn-link-glow" onclick="confirmAction(false)">Отмена</button>
            </div>
        </div>
    </div>


    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const userNameInput = document.getElementById('userName');
        const repoNameInput = document.getElementById('repoName');
        const fileNameInput = document.getElementById('fileName');
        const rawUrlCodeBlock = document.getElementById('rawUrlCodeBlock');
        const githubUrlCodeBlock = document.getElementById('githubUrlCodeBlock');
        const codeBlock = document.getElementById('codeBlock');
        const statusMessage = document.getElementById('statusMessage');
        const profileSelect = document.getElementById('profileSelect');
        const saveProfileModal = document.getElementById('saveProfileModal');
        const profileNameInput = document.getElementById('profileNameInput');
        const confirmModal = document.getElementById('confirmModal');
        const confirmMessage = document.getElementById('confirmMessage');

        // Initial setup
        updateUrl();
        loadProfiles();

        function updateUrl() {
            const userName = userNameInput.value.trim();
            const repoName = repoNameInput.value.trim();
            const fileName = fileNameInput.value.trim();

            const rawUrl = `https://raw.githubusercontent.com/${userName}/${repoName}/main/${fileName}`;
            const githubUrl = `https://github.com/${userName}/${repoName}/blob/main/${fileName}`;

            rawUrlCodeBlock.textContent = rawUrl;
            githubUrlCodeBlock.textContent = githubUrl;
            codeBlock.textContent = `<img src="${rawUrl}" alt="Изображение" class="w-full h-auto rounded-lg shadow-md"/>`;
        }

        function copyCode(elementId) {
            const element = document.getElementById(elementId);
            const textToCopy = element.textContent;
            
            try {
                // Use the older execCommand as a fallback for iframes
                const textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showStatus('Код успешно скопирован в буфер обмена!', 'success');
            } catch (err) {
                console.error('Не удалось скопировать текст: ', err);
                showStatus('Не удалось скопировать код. Попробуйте скопировать вручную.', 'danger');
            }
        }

        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = `alert mt-3 d-block alert-${type}`;
            setTimeout(() => {
                statusMessage.classList.add('d-none');
            }, 3000);
        }

        function clearVariables() {
            userNameInput.value = '';
            repoNameInput.value = '';
            fileNameInput.value = '';
            updateUrl();
            localStorage.removeItem('ghb_image_vars');
            showStatus('Переменные очищены.', 'info');
        }
        
        function exportVariables() {
            const data = {
                userName: userNameInput.value,
                repoName: repoNameInput.value,
                fileName: fileNameInput.value
            };
            const jsonString = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'image_config.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showStatus('Переменные экспортированы в image_config.json.', 'success');
        }

        function loadProfiles() {
            const profiles = JSON.parse(localStorage.getItem('ghb_profiles') || '{}');
            profileSelect.innerHTML = '<option value="">Выберите профиль</option>';
            for (const name in profiles) {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                profileSelect.appendChild(option);
            }
        }

        // Show the custom modal for saving a profile
        function saveProfile() {
            saveProfileModal.classList.remove('d-none');
            profileNameInput.focus();
        }

        // Hide the custom modal for saving a profile
        function hideSaveModal() {
            saveProfileModal.classList.add('d-none');
        }

        // Save the profile from the custom modal
        function saveProfileFromModal() {
            const profileName = profileNameInput.value.trim();
            if (profileName) {
                const profiles = JSON.parse(localStorage.getItem('ghb_profiles') || '{}');
                profiles[profileName] = {
                    userName: userNameInput.value,
                    repoName: repoNameInput.value,
                    fileName: fileNameInput.value
                };
                localStorage.setItem('ghb_profiles', JSON.stringify(profiles));
                loadProfiles();
                hideSaveModal();
                showStatus(`Профиль "${profileName}" сохранён.`, 'success');
            } else {
                showStatus('Имя профиля не может быть пустым.', 'danger');
            }
        }

        function loadProfile() {
            const profileName = profileSelect.value;
            if (profileName) {
                const profiles = JSON.parse(localStorage.getItem('ghb_profiles'));
                const profile = profiles[profileName];
                if (profile) {
                    userNameInput.value = profile.userName;
                    repoNameInput.value = profile.repoName;
                    fileNameInput.value = profile.fileName;
                    updateUrl();
                    showStatus(`Профиль "${profileName}" загружен.`, 'success');
                }
            } else {
                showStatus('Сначала выберите профиль для загрузки.', 'warning');
            }
        }

        let deleteProfileName = '';

        function showDeleteConfirm() {
            const profileName = profileSelect.value;
            if (!profileName) {
                showStatus('Сначала выберите профиль для удаления.', 'warning');
                return;
            }
            deleteProfileName = profileName;
            confirmMessage.textContent = `Вы уверены, что хотите удалить профиль "${profileName}"?`;
            confirmModal.classList.remove('d-none');
        }

        function confirmAction(isConfirmed) {
            confirmModal.classList.add('d-none');
            if (isConfirmed && deleteProfileName) {
                const profiles = JSON.parse(localStorage.getItem('ghb_profiles') || '{}');
                delete profiles[deleteProfileName];
                localStorage.setItem('ghb_profiles', JSON.stringify(profiles));
                loadProfiles();
                showStatus(`Профиль "${deleteProfileName}" удалён.`, 'info');
            }
            deleteProfileName = '';
        }
    </script>
</body>
</html>
