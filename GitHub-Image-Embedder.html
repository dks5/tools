<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Инструкция по замене изображений</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        body {
            background-color: #f0f2f5;
            color: #212529;
            font-family: sans-serif;
        }

        .card {
            background-color: #495057;
            color: #f8f9fa;
            border: none;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        .card h1, .card h2, .card h3, .card h4, .card p, .card .lead {
            color: #e9ecef;
        }
        
        .form-label {
            color: #adb5bd;
        }

        .form-control {
            background-color: #6c757d;
            border: 1px solid #6c757d;
            color: #f8f9fa;
        }
        .form-control::placeholder {
            color: #e9ecef;
            opacity: 0.7;
        }
        .form-control:focus {
            background-color: #6c757d;
            border-color: #007bff;
            box-shadow: 0 0 0 0.25rem rgba(0, 123, 255, 0.25);
            color: #f8f9fa;
        }
        .btn {
            border-radius: 0.5rem;
        }
        .btn-outline-secondary {
            color: #adb5bd;
            border-color: #adb5bd;
        }
        .btn-outline-secondary:hover {
            color: #fff;
            background-color: #adb5bd;
        }
        .btn-outline-primary {
            color: #007bff;
            border-color: #007bff;
        }
        .btn-outline-primary:hover {
            color: #fff;
            background-color: #007bff;
        }
        .btn-danger {
            color: #fff;
            background-color: #dc3545;
            border-color: #dc3545;
        }
        .btn-danger:hover {
            background-color: #c82333;
            border-color: #bd2130;
        }
        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
        }
        .btn-primary:hover {
            background-color: #0056b3;
            border-color: #0056b3;
        }

        .nav-link {
            color: #e9ecef;
        }
        .nav-link.active {
            background-color: #007bff !important;
            color: #fff !important;
        }

        .code-style {
            background-color: #343a40;
            color: #f8f9fa;
            border-radius: 0.5rem;
            padding: 1rem;
            font-family: 'Courier New', Courier, monospace;
            white-space: pre-wrap; /* Обеспечивает перенос текста */
            word-wrap: break-word; /* Обеспечивает перенос длинных слов */
        }
        
        .code-container {
            position: relative;
        }

        .copy-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: transparent;
            color: #adb5bd;
            border: none;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s, color 0.2s;
            cursor: pointer;
        }

        .copy-btn:hover {
            background-color: rgba(173, 181, 189, 0.2);
            color: #e9ecef;
        }

        .profile-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .profile-section button {
            flex-grow: 1;
        }

        .theory-content p {
            line-height: 1.8;
            margin-bottom: 1rem;
        }
        
        .theory-content h3 {
            margin-top: 2rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #007bff;
            padding-bottom: 0.5rem;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1050;
        }

        .modal-content {
            background-color: #495057;
            color: #f8f9fa;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            max-width: 500px;
            text-align: center;
        }

        @media (max-width: 767.98px) {
            .profile-section {
                flex-direction: column;
                gap: 0.5rem;
            }
            .profile-section button {
                width: 100%;
            }
        }
    </style>
</head>
<body class="bg-light">

    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card p-4">
                    <h2 class="text-center mb-4">Динамическая инструкция по замене изображений из GitHub</h2>
                    <hr class="my-4">

                    <!-- Табы -->
                    <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="instructions-tab" data-bs-toggle="tab" data-bs-target="#instructions" type="button" role="tab" aria-controls="instructions" aria-selected="true">Инструкция</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="theory-tab" data-bs-toggle="tab" data-bs-target="#theory" type="button" role="tab" aria-controls="theory" aria-selected="false">Теория</button>
                        </li>
                    </ul>

                    <!-- Содержимое табов -->
                    <div class="tab-content" id="myTabContent">
                        <!-- Вкладка "Инструкция" -->
                        <div class="tab-pane fade show active" id="instructions" role="tabpanel" aria-labelledby="instructions-tab">
                            <p class="text-center lead">Введите имя пользователя, репозитория и файла, чтобы сгенерировать HTML-код с прямой ссылкой на изображение.</p>
                            <!-- Блок конфигурации переменных -->
                            <div class="mb-4">
                                <h2 class="h4 mb-3">Конфигурация переменных</h2>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label for="userName" class="form-label">Имя пользователя (переменная #1):</label>
                                        <input type="text" id="userName" class="form-control" placeholder="Например: gemini-coder" oninput="updateUrl()">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="repoName" class="form-label">Имя репозитория (переменная #2):</label>
                                        <input type="text" id="repoName" class="form-control" placeholder="Например: my-project" oninput="updateUrl()">
                                    </div>
                                    <div class="col-12">
                                        <label for="fileName" class="form-label">Имя файла (переменная #3):</label>
                                        <input type="text" id="fileName" class="form-control" placeholder="Например: image.jpg" oninput="updateUrl()">
                                    </div>
                                </div>
                            </div>

                            <!-- Блок с динамическим URL -->
                            <div class="mb-4">
                                <h3 class="h5">Сгенерированный URL-адрес:</h3>
                                <div class="code-container">
                                    <button class="copy-btn" onclick="copyCode('urlCodeBlock')">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                    <pre id="urlCodeBlock" class="code-style"></pre>
                                </div>
                            </div>
                            
                            <!-- Блок для сохранения и загрузки профилей -->
                            <div class="mb-4">
                                <h3 class="h5">Профили</h3>
                                <!-- Новая структура с сеткой для выравнивания кнопок -->
                                <div class="row g-2 align-items-center">
                                    <!-- Выпадающий список и кнопка загрузки -->
                                    <div class="col-12 col-md-6">
                                        <div class="input-group">
                                            <select id="profileSelect" class="form-select"></select>
                                            <button class="btn btn-outline-secondary" type="button" onclick="loadProfile()"><i class="bi bi-folder2-open me-2"></i>Загрузить</button>
                                        </div>
                                    </div>
                                    <!-- Кнопки сохранения и удаления -->
                                    <div class="col-12 col-md-6 d-flex gap-2">
                                        <button class="btn btn-primary w-50" onclick="saveProfile()"><i class="bi bi-bookmark me-2"></i>Сохранить</button>
                                        <button class="btn btn-danger w-50" onclick="showDeleteConfirm()"><i class="bi bi-trash me-2"></i>Удалить</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Инструкция -->
                            <div class="mb-4">
                                <h2 class="h4 mb-3">Инструкция</h2>
                                <p>После того как вы настроили переменные выше, скопируйте следующий HTML-код, чтобы вставить изображение на свою страницу.</p>
                                
                                <div class="code-container">
                                    <button class="copy-btn" onclick="copyCode('codeBlock')">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                    <pre id="codeBlock" class="code-style">
&lt;img src="" alt="Изображение" class="w-full h-auto rounded-lg shadow-md"/&gt;
                                    </pre>
                                </div>
                            </div>

                            <!-- Кнопки управления данными -->
                            <div class="d-flex flex-column flex-sm-row justify-content-between gap-2 mt-4">
                                <button class="btn btn-primary" onclick="exportVariables()">
                                    <i class="bi bi-download me-2"></i>Экспорт в JSON
                                </button>
                                <button class="btn btn-danger" onclick="clearVariables()">
                                    <i class="bi bi-x-circle me-2"></i>Очистить переменные
                                </button>
                            </div>

                            <div id="statusMessage" class="alert mt-3 d-none"></div>
                        </div>

                        <!-- Вкладка "Теория" -->
                        <div class="tab-pane fade theory-content" id="theory" role="tabpanel" aria-labelledby="theory-tab">
                            <h2 class="h4 mb-3">Что такое `raw.githubusercontent.com`?</h2>
                            <p>
                                `https://raw.githubusercontent.com/` — это специальный домен, который GitHub использует для выдачи <b>«сырого»</b> (raw) содержимого файлов из репозиториев.
                            </p>
                            
                            <hr class="my-4">

                            <h3 class="h5">В чём разница между `github.com` и `raw.githubusercontent.com`?</h3>
                            <p>
                                Когда вы открываете файл, например, изображение, на сайте `github.com`, вы видите не только само изображение, но и всю веб-страницу GitHub вокруг него: заголовок репозитория, кнопки, комментарии и т.д. Этот путь предназначен для <b>просмотра</b> файла в веб-интерфейсе.
                            </p>
                            <p>
                                Когда вы используете путь с `raw.githubusercontent.com`, вы получаете доступ к самому файлу <b>без какого-либо форматирования или окружения GitHub</b>. Браузер сразу видит, что это файл изображения, и может использовать его напрямую. Это идеальный способ для встраивания изображений, CSS-стилей или JavaScript-файлов в другие веб-страницы.
                                                            </p>
                            
                            <hr class="my-4">

                            <h3 class="h5">Структура URL-адреса</h3>
                            <p>
                                Путь имеет чёткую структуру, которую мы используем в нашей инструкции:
                            </p>
                            <ul>
                                <li><b>`https://raw.githubusercontent.com/`</b> — базовая часть для "сырого" контента.</li>
                                <li><b>`имя-пользователя`</b> — имя пользователя или организации.</li>
                                <li><b>`имя-репозитория`</b> — имя вашего репозитория.</li>
                                <li><b>`ветка`</b> — имя ветки, где находится файл, чаще всего это `main` или `master`.</li>
                                <li><b>`имя-файла`</b> — полный путь к файлу в репозитории.</li>
                            </ul>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Custom Modal for Confirm -->
    <div id="confirmModal" class="modal-overlay d-none">
        <div class="modal-content">
            <p id="confirmMessage" class="lead"></p>
            <div class="d-flex justify-content-center gap-3">
                <button class="btn btn-danger" onclick="confirmAction(true)">Удалить</button>
                <button class="btn btn-outline-secondary" onclick="confirmAction(false)">Отмена</button>
            </div>
        </div>
    </div>


    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const userNameInput = document.getElementById('userName');
        const repoNameInput = document.getElementById('repoName');
        const fileNameInput = document.getElementById('fileName');
        const urlCodeBlock = document.getElementById('urlCodeBlock');
        const codeBlock = document.getElementById('codeBlock');
        const statusMessage = document.getElementById('statusMessage');
        const profileSelect = document.getElementById('profileSelect');

        // Initial setup
        updateUrl();
        loadProfiles();

        function updateUrl() {
            const userName = userNameInput.value.trim();
            const repoName = repoNameInput.value.trim();
            const fileName = fileNameInput.value.trim();
            const url = `https://raw.githubusercontent.com/${userName}/${repoName}/main/${fileName}`;
            urlCodeBlock.textContent = url;
            codeBlock.textContent = `<img src="${url}" alt="Изображение" class="w-full h-auto rounded-lg shadow-md"/>`;
        }

        function copyCode(elementId) {
            const element = document.getElementById(elementId);
            const textToCopy = element.textContent;
            
            try {
                // Use the older execCommand as a fallback for iframes
                const textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showStatus('Код успешно скопирован в буфер обмена!', 'success');
            } catch (err) {
                console.error('Не удалось скопировать текст: ', err);
                showStatus('Не удалось скопировать код. Попробуйте скопировать вручную.', 'danger');
            }
        }

        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = `alert mt-3 d-block alert-${type}`;
            setTimeout(() => {
                statusMessage.classList.add('d-none');
            }, 3000);
        }

        function saveVariables() {
            const data = {
                userName: userNameInput.value,
                repoName: repoNameInput.value,
                fileName: fileNameInput.value
            };
            localStorage.setItem('ghb_image_vars', JSON.stringify(data));
            showStatus('Переменные сохранены.', 'success');
        }

        function loadVariables() {
            const data = localStorage.getItem('ghb_image_vars');
            if (data) {
                const vars = JSON.parse(data);
                userNameInput.value = vars.userName;
                repoNameInput.value = vars.repoName;
                fileNameInput.value = vars.fileName;
                updateUrl();
                showStatus('Переменные загружены.', 'success');
            } else {
                showStatus('Сохранённые переменные не найдены.', 'warning');
            }
        }

        function clearVariables() {
            userNameInput.value = '';
            repoNameInput.value = '';
            fileNameInput.value = '';
            updateUrl();
            localStorage.removeItem('ghb_image_vars');
            showStatus('Переменные очищены.', 'info');
        }
        
        function exportVariables() {
            const data = {
                userName: userNameInput.value,
                repoName: repoNameInput.value,
                fileName: fileNameInput.value
            };
            const jsonString = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'image_config.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showStatus('Переменные экспортированы в image_config.json.', 'success');
        }

        function loadProfiles() {
            const profiles = JSON.parse(localStorage.getItem('ghb_profiles') || '{}');
            profileSelect.innerHTML = '<option value="">Выберите профиль</option>';
            for (const name in profiles) {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                profileSelect.appendChild(option);
            }
        }

        let deleteProfileName = '';

        function showDeleteConfirm() {
            const profileName = profileSelect.value;
            if (!profileName) {
                showStatus('Сначала выберите профиль для удаления.', 'warning');
                return;
            }
            deleteProfileName = profileName;
            document.getElementById('confirmMessage').textContent = `Вы уверены, что хотите удалить профиль "${profileName}"?`;
            document.getElementById('confirmModal').classList.remove('d-none');
        }

        function confirmAction(isConfirmed) {
            document.getElementById('confirmModal').classList.add('d-none');
            if (isConfirmed && deleteProfileName) {
                const profiles = JSON.parse(localStorage.getItem('ghb_profiles') || '{}');
                delete profiles[deleteProfileName];
                localStorage.setItem('ghb_profiles', JSON.stringify(profiles));
                loadProfiles();
                showStatus(`Профиль "${deleteProfileName}" удалён.`, 'info');
            }
            deleteProfileName = '';
        }

        // Old deleteProfile function is now replaced by showDeleteConfirm and confirmAction
        // function deleteProfile() { ... }
    </script>
</body>
</html>
